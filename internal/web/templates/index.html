<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Go Links</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        body{font-family:system-ui,-apple-system,sans-serif;max-width:900px;margin:2rem auto;padding:1rem;background:#f4f4f9}
        .card{background:#fff;padding:1.5rem;border-radius:8px;box-shadow:0 2px 5px #0000001a;margin-bottom:1.5rem}
        input{width:100%;padding:10px;margin:5px 0 15px;border:1px solid #ddd;border-radius:4px;box-sizing:border-box}
        button{background:#007bff;color:#fff;border:none;padding:10px;border-radius:4px;cursor:pointer;width:100%;font-size:1rem}
        button:hover{background:#0056b3}

        table{width:100%;border-collapse:collapse;margin-top:1rem}
        thead{background:#f8f9fa;border-bottom:2px solid #dee2e6}
        th{padding:12px;text-align:left;font-weight:600;color:#495057;font-size:.9rem;text-transform:uppercase;letter-spacing:.5px}
        tbody tr{border-bottom:1px solid #dee2e6;transition:background .2s}
        tbody tr:hover{background:#f8f9fa}
        td{padding:12px;vertical-align:middle}

        .shortcut-cell{font-family:monospace;background:#e9ecef;padding:4px 8px;border-radius:4px;display:inline-block;font-size:.95rem;font-weight:600;color:#495057}
        .url-cell{color:#6c757d;font-size:.9rem;max-width:400px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
        .url-cell a{color:#007bff;text-decoration:none;transition:color .2s}
        .url-cell a:hover{color:#0056b3;text-decoration:underline}
        .actions-cell{display:flex;gap:8px;justify-content:flex-end}

        .btn-edit,.btn-delete{font-size:.85rem;padding:6px 12px;cursor:pointer;border:1px solid;border-radius:4px;background:transparent;transition:all .2s;font-weight:500}
        .btn-edit{color:#28a745;border-color:#28a745}
        .btn-edit:hover{background:#28a745;color:#fff}
        .btn-delete{color:#dc3545;border-color:#dc3545}
        .btn-delete:hover{background:#dc3545;color:#fff}

        .edit-row{display:none}
        .edit-row td{background:#f8f9fa;padding:15px}
        .edit-form{display:flex;gap:10px;align-items:center}
        .edit-form input{margin:0;padding:10px;flex:1}
        .edit-form button{width:auto;padding:8px 16px;font-size:.9rem;margin:0}
        .edit-form .btn-save{background:#28a745;border:none}
        .edit-form .btn-save:hover{background:#218838}
        .edit-form .btn-cancel{background:#6c757d;border:none}
        .edit-form .btn-cancel:hover{background:#5a6268}

        .empty-state{text-align:center;padding:3rem 1rem;color:#6c757d}
        .empty-state-icon{font-size:3rem;margin-bottom:1rem;opacity:.5}

        @media(max-width:768px){
            body{margin:1rem auto;padding:.5rem}
            .card{padding:1rem;margin-bottom:1rem}
            h1{font-size:1.5rem;text-align:center}
            h2{font-size:1.2rem}
            thead{display:none}
            tbody tr{display:block;margin-bottom:1rem;border:1px solid #dee2e6;border-radius:8px;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,.1);padding:0}
            tbody tr:hover{background:#fff}
            td{display:block;padding:10px 15px;border:none;text-align:left}
            td:before{content:attr(data-label);font-weight:600;color:#495057;display:block;margin-bottom:5px;font-size:.85rem;text-transform:uppercase;letter-spacing:.5px}
            .shortcut-cell{display:block;width:fit-content;font-size:1rem;padding:6px 10px}
            .url-cell{max-width:100%;white-space:normal;word-break:break-all;font-size:.85rem}
            .actions-cell{justify-content:stretch;padding:10px 15px 15px}
            .actions-cell:before{display:none}
            .btn-edit,.btn-delete{flex:1;text-align:center;padding:10px;font-size:.9rem}
            .edit-row{display:none;border:none;margin-bottom:1rem;padding:0}
            .edit-row td{padding:15px;background:#f8f9fa;border-radius:8px}
            .edit-form{flex-direction:column;gap:10px}
            .edit-form strong{display:block;margin-bottom:5px;font-size:.9rem;color:#495057}
            .edit-form input{width:100%}
            .edit-form button{width:100%;padding:10px}
        }
        @media(max-width:480px){
            body{padding:.25rem}
            .card{padding:.75rem;border-radius:6px}
            h1{font-size:1.3rem}
            h2{font-size:1.1rem}
            input{padding:8px;font-size:.95rem}
            button{padding:8px;font-size:.95rem}
        }
    </style>
</head>
<body>
    <h1>Go Links</h1>
    <div class="card">
        <h2>Create Link</h2>
        <form method="POST" action="/">
            <label>Shortcut</label>
            <input name="key" value="{{.PrefilledKey}}" required placeholder="name" pattern="[a-zA-Z0-9_-]+">
            <label>Destination URL</label>
            <input type="url" name="url" required placeholder="https://...">
            <button>Create</button>
        </form>
    </div>
    <div class="card">
        <h2>Shortcuts</h2>
        {{if not .Links}}
        <div class="empty-state">
            <div class="empty-state-icon">&#x1F517;</div>
            <p>No links yet. Create your first shortcut above!</p>
        </div>
        {{else}}
        <table>
            <thead>
                <tr>
                    <th>Shortcut</th>
                    <th>Destination</th>
                    <th style="text-align:right">Actions</th>
                </tr>
            </thead>
            <tbody>
            {{range .Links}}
                <tr id="row-{{.Key}}">
                    <td data-label="Shortcut"><span class="shortcut-cell">go/{{.Key}}</span></td>
                    <td data-label="Destination" class="url-cell"><a href="{{.URL}}" target="_blank" title="{{.URL}}">{{.URL}}</a></td>
                    <td data-label="Actions" class="actions-cell">
                        <button class="btn-edit" onclick="editLink('{{.Key}}')">Edit</button>
                        <button class="btn-delete" onclick="deleteLink('{{.Key}}')">Delete</button>
                    </td>
                </tr>
                <tr id="edit-{{.Key}}" class="edit-row">
                    <td colspan="3">
                        <form class="edit-form" onsubmit="return updateLink('{{.Key}}', event)">
                            <strong>go/{{.Key}}</strong>
                            <input type="url" name="url" value="{{.URL}}" required placeholder="https://...">
                            <button type="submit" class="btn-save">Save</button>
                            <button type="button" class="btn-cancel" onclick="cancelEdit('{{.Key}}')">Cancel</button>
                        </form>
                    </td>
                </tr>
            {{end}}
            </tbody>
        </table>
        {{end}}
    </div>
    <script>
        function editLink(key) {
            document.getElementById('row-' + key).style.display = 'none';
            document.getElementById('edit-' + key).style.display = 'table-row';
        }

        function cancelEdit(key) {
            document.getElementById('row-' + key).style.display = 'table-row';
            document.getElementById('edit-' + key).style.display = 'none';
        }

        function updateLink(key, event) {
            event.preventDefault();
            const formData = new FormData();
            formData.append('url', event.target.url.value);

            fetch('/api/update/' + encodeURIComponent(key), {method: 'POST', body: formData})
                .then(r => { if (r.ok) location.reload(); else alert('Failed to update link'); })
                .catch(e => alert('Error: ' + e));
            return false;
        }

        function deleteLink(key) {
            if (!confirm('Delete link "' + key + '"?')) return;
            fetch('/api/delete/' + encodeURIComponent(key), {method: 'POST'})
                .then(r => { if (r.ok) location.reload(); else alert('Failed to delete link'); })
                .catch(e => alert('Error: ' + e));
        }
    </script>
</body>
</html>
